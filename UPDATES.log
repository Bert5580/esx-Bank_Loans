# UPDATES.log
# Bank Loans System - Update Log
# Last Updated: [February 15, 2025]

--------------------------------------------------------
## Version Ev1.0.7 - [February 15, 2025]
### **New Features:**
- **Added SQL Validation Scripts:**
  - Ensures `users` and `player_loans` tables exist before executing queries.
  - Prevents database crashes due to missing columns or tables.
  
- **Implemented Stored Procedures:**
  - `sp_validate_loans` checks for orphaned loans and negative balances.
  - `sp_auto_repay_loans` deducts loan payments automatically from paychecks.
  
- **Loan Interest System Update:**
  - Added a scheduled event `apply_interest_event` to apply monthly interest automatically.
  - Ensures all active loans accumulate interest correctly.

- **Loan History Logging:**
  - New `loan_history` table logs all loan grants and repayments.
  - Helps in tracking player loan activities over time.

### **Bug Fixes & Optimizations:**
- Fixed missing `identifier` column references in SQL queries.
- Ensured `bankloan:getCreditAndLoans` event properly fetches loan data.
- `/check_debit` now displays correct remaining debt even after partial repayments.
- Optimized MySQL queries to improve performance and prevent duplicate data entries.
- Enhanced server-side validation for loan repayment and paycheck deductions.

--------------------------------------------------------
## Version Ev1.0.6 - [February 12, 2025]
### **New Features:**
- **Fixed Loan Menu Issue**:
  - Players using **esx_menu_default** can now successfully open the loan menu when pressing **[H]**.
  - NPC interactions are now **fully functional**.

- **Improved Loan Repayment System**:
  - `/pay_loan` now **correctly updates the database** and **notifies the player**.
  - Loans are repaid in order of oldest to newest to **prevent abuse**.
  - Players now **gain 150 credit** upon fully repaying their loans.

- **Reworked Database Queries**:
  - Ensured all MySQL queries execute **efficiently and securely**.
  - Fixed issues with debt not decreasing properly after a payment.
  - Added **checks** to prevent **exploits** related to loan repayment.

- **Admin Loan Management Enhancements**:
  - `/grant_loan` now correctly assigns loans with **player ID, amount, and interest rate**.
  - Added **confirmation messages** for successful or failed loan grants.
  - **Prevented duplicate loans** from being issued to a player simultaneously.

- **Configurable Loan System Enhancements**:
  - Loan conditions, such as **credit score requirements** and **interest rates**, can now be modified in `config.lua`.
  - Introduced **a toggle for esx_menu_default** in `config.lua`.

### **Bug Fixes & Optimizations:**
- Fixed **NPC interactions not registering correctly**.
- Corrected **credit not updating after a full loan repayment**.
- Ensured `/check_debit` always reflects the **latest debt balance**.
- Improved **server-side security** to prevent SQL injection exploits.
- Minor **performance improvements** in **database queries** and **event handling**.

--------------------------------------------------------
# ðŸš€ Future Updates
- **ATM Loan Repayments**.
- **More Loan Locations**.
- **Better Interest Rate Calculations**.
- **Custom Loan Plans for Different Player Groups**.

### ðŸ’¡ Need Help?
Join our support community or open an issue!
